<div class="timesheet">
  <div class="timesheet__filter-section">

    <form class="timesheet-filter">
      <div class="timesheet-filter__field">
        <label for="employeeName" class="timesheet-filter__label">Nome do colaborador:</label>
        <input type="text" class="timesheet-filter__input" name="employeeName" placeholder="Ex: João Batista"
          [(ngModel)]="employeeNameFilter" (input)="filterEmployees()">
      </div>

      <div class="timesheet-filter__field">
        <label for="status" class="timesheet-filter__label">Status:</label>
        <select name="status" id="status" class="timesheet-filter__select" [(ngModel)]="statusFilter">
          <option value="all">Todos</option>
          <option value="presentes">Presentes</option>
          <option value="ausentes">Ausentes</option>
        </select>
      </div>

      <div class="timesheet-filter__field">
        <label for="allowance" class="timesheet-filter__label">Abono:</label>
        <select name="allowance" id="allowance" class="timesheet-filter__select" [(ngModel)]="allowanceFilter">
          <option value="">Nenhum</option>
          <option value="férias">Férias</option>
          <option value="Atestado Médico">Atestado</option>
          <option value="paid">Abonado</option>
        </select>
      </div>

      <div class="timesheet-filter__field">
        <label for="dateStart" class="timesheet-filter__label">Data inicial:</label>
        <input type="date" id="dateStart" class="timesheet-filter__input" [(ngModel)]="startDateFilter"
          name="startDate">
      </div>

      <div class="timesheet-filter__field">
        <label for="dateEnd" class="timesheet-filter__label">Data final:</label>
        <input type="date" id="dateEnd" class="timesheet-filter__input" [(ngModel)]="endDateFilter" name="endDate">
      </div>

      <button type="button" class="timesheet-filter__button" (click)="search()">Pesquisar</button>
    </form>

  </div>

  <div *ngIf="isLoading" class="timesheet__loading">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <div class="timesheet__content" *ngIf="showEmployeeTable && !isLoading">
    <table class="employee-table">
      <tbody class="employee-table__body">
        <tr *ngFor="let employee of filteredEmployees" class="employee-table__row">
          <td class="employee-table__cell employee-table__cell--stripe"></td>
          <td class="employee-table__cell employee-table__cell--avatar">
            <img [src]="employee.avatar" alt="Avatar do colaborador" class="employee-table__avatar">
          </td>
          <td class="employee-table__cell employee-table__cell--info">
            <div class="employee-table__name">{{ employee.name }}</div>
            <div class="employee-table__role">{{ employee.role }}</div>
          </td>
          <td class="employee-table__cell employee-table__cell--email">{{ employee.email }}</td>
          <td class="employee-table__cell employee-table__cell--actions">
            <button type="button" class="employee-table__button"
              (click)="openTimesheetDetails(employee)">Detalhes</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Quando apenas a data inicial está definida (exibe registros individuais) -->
  <div class="timesheet__content" *ngIf="!showEmployeeTable && !isLoading && startDateFilter && !endDateFilter">
    <table class="employee-table">
      <tbody class="employee-table__body">
        <tr *ngFor="let records of timesheet" class="employee-table__row">
          <td class="employee-table__cell employee-table__cell--stripe"></td>
          <td class="employee-table__cell employee-table__cell--avatar">
            <img [src]="defaultAvatar" alt="Avatar do colaborador" class="employee-table__avatar">
          </td>
          <td class="employee-table__cell employee-table__cell--info">
            <div class="employee-table__name">{{ records.NOME }}</div>
            <div class="employee-table__role">{{ records.CHAPA }}</div>
          </td>
          <td class="employee-table__cell employee-table__cell--email">{{ records.PERIODO }}</td>
          <td class="employee-table__cell employee-table__cell--email">{{ records.FALTA }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Quando ambas as datas estão definidas (agrupa por colaborador) -->
  <div class="timesheet__content" *ngIf="!showEmployeeTable && !isLoading && startDateFilter && endDateFilter">
    <table class="employee-table">
      <tbody class="employee-table__body">
        <tr *ngFor="let employee of consolidatedTimesheet" class="employee-table__row">
          <td class="employee-table__cell employee-table__cell--stripe"></td>
          <td class="employee-table__cell employee-table__cell--avatar">
            <img [src]="defaultAvatar" alt="Avatar do colaborador" class="employee-table__avatar">
          </td>
          <td class="employee-table__cell employee-table__cell--info">
            <div class="employee-table__name">{{ employee.NOME }}</div>
            <div class="employee-table__role">{{ employee.CHAPA }}</div>
          </td>
          <td class="employee-table__cell employee-table__cell--actions">
            <button type="button" class="employee-table__button"
              (click)="openTimesheetDetails(employee)">Detalhes</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
