<div class="container">

  <!-- MENSAGEM -->
  @if (showMessage) {
  <div class="message" [ngClass]="messageType">{{ message }}</div>
  }

  <div class="aside">
    <button type="button" class="btn btn__launch" (click)="findByStatus('NOVO')"
      [class.active]="activeStatus === 'NOVO'">
      Novos
    </button>

    <button type="button" class="btn btn__launch" (click)="findByStatus('ANDAMENTO')"
      [class.active]="activeStatus === 'ANDAMENTO'">
      Em andamento
    </button>

    <button type="button" class="btn btn__launch" (click)="findByStatus('CONCLUIDO')"
      [class.active]="activeStatus === 'CONCLUIDO'">
      Concluídos
    </button>

    <button type="button" class="btn btn__launch" (click)="findByStatus('CANCELADO')"
      [class.active]="activeStatus === 'CANCELADO'">
      Cancelados
    </button>

    <input type="text" placeholder="Buscar" class="input" [(ngModel)]="employee" (input)="applyFilters()" />
  </div>

  <div class="main">
    <div class="card" *ngFor="let item of items">
      <div class="card__header" (click)="openMenu(item)" [ngStyle]="{ 'border-left-color': setBorderColor(item.tipo) }">
        <div class="display display--column">
          <div class="card__group card__group--row">
            <h3 class="title title--dark">{{ item.empData.nome }}</h3>
          </div>
          <div class="card__group card__group--row">
            <div class="bubble">
              <h3 class="title title--dark-orange">{{ item.empData.funcao }}</h3>
            </div>
            <div class="bubble">
              <h3 class="title title--dark-orange">{{ item.empData.centro_custo }}</h3>
            </div>
          </div>
        </div>
      </div>
      <div class="card__body">
        <div class="card__group card__group--body">
          <div class="card__group card__group--icon">
            <mat-icon class="icon icon--small icon--orange">
              person
            </mat-icon>
          </div>
          <div class="">
            <h3 class="title title--light">SOLICITANTE</h3>
            <h3 class="title title--dark">{{ item.criador }}</h3>
          </div>
        </div>
        <div class="card__group card__group--body">
          <div class="card__group card__group--icon">
            <mat-icon class="icon icon--small icon--orange">
              category
            </mat-icon>
          </div>
          <div class="">
            <h3 class="title title--light">TIPO DE ADVERTÊNCIA</h3>
            <h3 class="title title--dark">{{ item.advertencia || 'N/A' }}</h3>
          </div>
        </div>
        <div class="card__group card__group--body">
          <div class="card__group card__group--icon">
            <mat-icon class="icon icon--small icon--orange">
              calendar_today
            </mat-icon>
          </div>
          <div class="">
            <h3 class="title title--light">DATA DO OCORRIDO</h3>
            <h3 class="title title--dark">{{ formateDate(item.data_ocorrido) || 'N/A' }}</h3>
          </div>
        </div>
        <div class="card__group card__group--body">
          <div class="card__group card__group--icon">
            <mat-icon class="icon icon--small icon--orange">
              article
            </mat-icon>
          </div>
          <div class="">
            <h3 class="title title--light">MOTIVO</h3>
            <h3 class="title title--dark">{{ item.motivo }}</h3>
          </div>
        </div>
        <div class="card__group card__group--large card__group--body">
          <div class="card__group card__group--icon">
            <mat-icon class="icon icon--small icon--orange">
              notes
            </mat-icon>
          </div>
          <div class="">
            <h3 class="title title--light">OBSERVAÇÃO</h3>
            <h3 class="title title--dark">{{ item.observacao || 'N/A' }}</h3>
          </div>
        </div>
      </div>
    </div>

    <div class="blurred-background" *ngIf="menuModalOpen">
      <form class="modal">
        <div class="modal__header">
          <h3 class="title title--large title--dark">Menu</h3>
          <button class="icon icon--close icon--dark" (click)="closeModals()">
            &times;
          </button>
        </div>
        <div class="modal__body">
          <button type="button" class="btn btn__action" (click)="download()">
            @if (isDownloading) {
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            } @else {
            Gerar PDF
            }
          </button>
          <button type="button" class="btn btn__action" (click)="openUpdateModal()">
            Atualizar Registro
          </button>
        </div>
        <div class="modal__footer">
          <button type="button" class="btn btn__action" (click)="closeModals()">
            Fechar
          </button>
        </div>
      </form>
    </div>

    <div class="blurred-background" *ngIf="updateModalOpen">
      <form class="modal" [formGroup]="updateForm" (ngSubmit)="update()">
        <div class="modal__header">
          <h3 class="title title--large title--dark">Atualizar</h3>
          <button class="icon icon--close icon--dark" (click)="closeModals()">
            &times;
          </button>
        </div>
        <div class="modal__body">
          <div class="card__group card__group--column">
            <label class="title title--medium title--light">Status</label>
            <select class="select select__modal select__modal--dark" formControlName="status">
              <option value="">Selecione uma opção</option>
              <option value="ANDAMENTO">Em andamento</option>
              <option value="CONCLUIDO">Concluído</option>
              <option value="CANCELADO">Cancelado</option>
            </select>
          </div>
          <div class="card__group card__group--column">
            <label class="title title--medium title--light">Tipo de advertência</label>
            <select class="select select__modal select__modal--dark" formControlName="advertencia">
              <option value="">Selecione uma opção</option>
              <option value="VERBAL">Verbal</option>
              <option value="ESCRITA">Escrita</option>
              <option value="SUSPENSAO">Suspensão</option>
            </select>
          </div>
          <div class="card__group card__group--column card__group--full">
            <label class="title title--medium title--light">Observação</label>
            <textarea formControlName="observacao" class="textarea textarea__modal textarea__modal--dark"></textarea>
          </div>
        </div>
        <div class="modal__footer">
          <button type="button" class="btn btn__action" (click)="returnModal()">
            Voltar
          </button>
          <button type="submit" class="btn btn__action">
            @if (isLoading) {
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            } @else {
            Atualizar
            }
          </button>
        </div>
      </form>
    </div>

    <div class="centralized" *ngIf="isSearching">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    </div>

    <div class="centralized centralized--column" *ngIf="isEmpty">
      <mat-icon class="icon icon--large icon--light">wrong_location</mat-icon>
      <h3 class="title title--large title--light">Nenhuma solicitação encontrada</h3>
    </div>
  </div>
</div>
