<div class="container">

  @if (showSuccess) {
    <div class="message message--success">
      <mat-icon>check_circle</mat-icon>
      <span>{{ successMessage }}</span>
    </div>
    }

  <div class="filter__container">

    <div class="filter__left">
      <div class="filter">
        <button [class.active]="activeButton === 'geral'" (click)="activeButton = 'geral'; showGeral()"
          class="filter__btn">GERAL</button>
      </div>

      <div class="filter">
        <button [class.active]="activeButton === 'records'" (click)="activeButton = 'records'; showRecords()"
          class="filter__btn">REGISTROS</button>
      </div>

      <div class="filter">
        <button [class.active]="activeButton === 'employees'" (click)="activeButton = 'employees'; showEmployees()"
          class="filter__btn">COLABORADORES</button>
      </div>
    </div>

    <div class="filter__right">
      <form [formGroup]="recordForm" (ngSubmit)="getRecordByDate()">
        <div class="filter" *ngIf="recordsSection || geralSection">
          <input type="date" formControlName="date">
        </div>

        <div class="filter" *ngIf="recordsSection || geralSection">
          <button type="submit" class="filter__btn">BUSCAR</button>
        </div>
      </form>

      <div class="filter" *ngIf="employeesSection">
        <button (click)="addEmployee = true" class="filter__btn">+ Novo</button>
      </div>
    </div>
  </div>

  <div class="grafic__container" *ngIf="geralSection">
    <div class="grafic__card">
      <h2 class="grafic__title">Vale Refeição</h2>
      <div class="grafic__circle">
        <div class="circle-content">
          <span class="currency">R$</span>
          <span class="value">{{ formatCurrency(totalVR) }}</span>
        </div>
      </div>
    </div>

    <div class="grafic__card">
      <h2 class="grafic__title">Vale Transporte</h2>
      <div class="grafic__circle">
        <div class="circle-content">
          <span class="currency">R$</span>
          <span class="value">{{ formatCurrency(totalVT) }}</span>
        </div>
      </div>
    </div>

    <div class="grafic__card">
      <h2 class="grafic__title">Vale Combustível</h2>
      <div class="grafic__circle">
        <div class="circle-content">
          <span class="currency">R$</span>
          <span class="value">{{ formatCurrency(totalVC) }}</span>
        </div>
      </div>
    </div>

    <div class="grafic__card">
      <h2 class="grafic__title">Valor Total</h2>
      <div class="grafic__circle">
        <div class="circle-content">
          <span class="currency">R$</span>
          <span class="value">{{ formatCurrency(totalCost) }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card__container" *ngIf="recordsSection">
    <div *ngFor="let item of items" class="card">
      <div class="card__header">
        <div class="card__primary">
          <div class="card__top">
            <div class="card__title">{{ item.nome || 'N/A' }}</div>
            <div class="card__subtitle">|</div>
            <div class="card__subtitle">{{ item.tipo_contrato || 'N/A' }}</div>
          </div>
          <div class="card__bottom">
            <div class="card__subtitle">{{ item.funcao || 'N/A' }}</div>
          </div>
        </div>
        <div class="card__secondary">
          <div class="card__text">
            <div class="card__subtitle">DIAS DE TRABALHO: </div>
            <div class="card__title">{{ item.dias_uteis || 'N/A' }}</div>
            <div class="card__subtitle">|</div>
          </div>
          <div class="card__text">
            <div class="card__subtitle">DIAS EXTRAS: </div>
            <div class="card__title">{{ item.dias_extras || 'N/A' }}</div>
            <div class="card__subtitle">|</div>
          </div>
          <div class="card__text">
            <div class="card__subtitle">FALTAS: </div>
            <div class="card__title">{{ item.faltas || 'N/A' }}</div>
            <div class="card__subtitle">|</div>
          </div>
          <div class="card__text">
            <div class="card__subtitle">ATESTADOS: </div>
            <div class="card__title">{{ item.atestados || 'N/A' }}</div>
          </div>
        </div>
      </div>
      <div class="card__body">
        <div class="card__content">
          <div>
            <div class="card__subtitle">VALE REFEIÇÃO DIA</div>
            <div class="card__title">R$ {{ item.vale_refeicao_dia || '0' }}</div>
          </div>
          <div>
            <div class="card__subtitle">VALE REFEIÇÃO MÊS</div>
            <div class="card__title">R$ {{ totalMonth(item.dias_uteis, item.vale_refeicao_dia) || '0' }}</div>
          </div>
          <div>
            <div class="card__subtitle">VALE TRANSPORTE DIA</div>
            <div class="card__title">R$ {{ item.vale_transporte_dia || '0' }}</div>
          </div>
          <div>
            <div class="card__subtitle">VALE TRANSPORTE MÊS</div>
            <div class="card__title">R$ {{ totalMonth(item.dias_uteis, item.vale_transporte_dia) || '0' }}</div>
          </div>
          <div>
            <div class="card__subtitle">VALE COMBUSTÍVEL DIA</div>
            <div class="card__title">R$ {{ item.vale_combustivel_dia || '0' }}</div>
          </div>
          <div>
            <div class="card__subtitle">VALE COMBUSTÍVEL MÊS</div>
            <div class="card__title">R$ {{ totalMonth(item.dias_uteis, item.vale_combustivel_dia) || '0' }}</div>
          </div>
          <div>
            <div class="card__subtitle">VALOR TOTAL</div>
            <div class="card__title">R$ {{ totalExpense(item.dias_uteis, item.vale_refeicao_dia,
              item.vale_transporte_dia, item.vale_combustivel_dia) || '0' }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card__empty" *ngIf="isAlert">
      <mat-icon>calendar_month</mat-icon>
      <span>Selecione o mês que deseja visualizar :)</span>
    </div>

    <div class="loading" *ngIf="isLoading">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    </div>
  </div>

  <div class="employees__container" *ngIf="employeesSection">
    <div class="employees" *ngFor="let employee of employees">
      <div class="employees__title">{{ employee.nome || 'N/A'}}</div>
    </div>

    <form [formGroup]="employeeForm" (ngSubmit)="createEmployee()" *ngIf="addEmployee" class="modal-backdrop">
      <div class="employee-form">
        <div class="employee-form__header">
          <h2>Adicionar Colaborador</h2>
          <button class="close-btn" (click)="addEmployee = false">&times;</button>
        </div>

        <div class="employee-form__content">
          <div class="form-group form-group--full">
            <label>Nome</label>
            <input type="text" placeholder="Nome completo" formControlName="nome">
          </div>

          <div class="form-group">
            <label>Posição</label>
            <select formControlName="posicao">
              <option value="" disabled selected>Selecione uma posição</option>
              <option value="DIRETOR">DIRETOR</option>
              <option value="SERVENTE">SERVENTE</option>
              <option value="PEDREIRO">PEDREIRO</option>
              <option value="AUXILIAR">AUXILIAR</option>
              <option value="ESTAGIÁRIO">ESTAGIÁRIO</option>
              <option value="COORDENADOR">COORDENADOR</option>
            </select>
          </div>

          <div class="form-group">
            <label>Setor</label>
            <select formControlName="setor">
              <option value="" disabled selected>Selecione um setor</option>
              <option value="T.I">T.I</option>
              <option value="OBRA">OBRA</option>
              <option value="COMPRAS">COMPRAS</option>
              <option value="ORÇAMENTO">ORÇAMENTO</option>
              <option value="QUALIDADE">QUALIDADE</option>
              <option value="FINANCEIRO">FINANCEIRO</option>
              <option value="PLANEJAMENTO">PLANEJAMENTO</option>
              <option value="ADMINISTRATIVO">ADMINISTRATIVO</option>
              <option value="RECURSOS HUMANOS">RECURSOS HUMANOS</option>
            </select>
          </div>

          <div class="form-group">
            <label>Contrato</label>
            <select formControlName="contrato">
              <option value="" disabled selected>Selecione um tipo</option>
              <option value="PJ">PJ</option>
              <option value="CLT">CLT</option>
              <option value="ESTÁGIO">ESTÁGIO</option>
            </select>
          </div>

          <div class="form-group form-group--full">
            <label>Centro de Custo</label>
            <select formControlName="centro_custo">
              <option value="" disabled selected>Selecione um centro de custo</option>
              <option value="ESCRITÓRIO">ESCRITÓRIO</option>
              <option value="BRK - EQUIPES DISPONÍVEIS">BRK - EQUIPES DISPONÍVEIS</option>
              <option value="BRK - PEIXINHOS">BRK - PEIXINHOS</option>
              <option value="BRK HH - IMPERMEABILIZAÇAO">BRK HH - IMPERMEABILIZAÇAO</option>
              <option value="EMLURB">EMLURB</option>
              <option value="ETE CABANGA - COMPLEMENTO MURO">ETE CABANGA - COMPLEMENTO MURO</option>
              <option value="ETES 02 CURADO">ETES 02 CURADO</option>
              <option value="HEINEKEN ALAGOINHAS">HEINEKEN ALAGOINHAS</option>
              <option value="MERCADO BOA VISTA">MERCADO BOA VISTA</option>
              <option value="US IRMÃ DENIZE">US IRMÃ DENIZE</option>
              <option value="US PROFESSOR ANTÔNIO FRANCISCO AREIAS">US PROFESSOR ANTÔNIO FRANCISCO AREIAS</option>
              <option value="USF DR LUIZ WILSON">USF DR LUIZ WILSON</option>
            </select>
          </div>

          <div class="form-group">
            <label>Vale Refeição</label>
            <input type="number" placeholder="0.00" formControlName="vr">
          </div>

          <div class="form-group">
            <label>Vale Transporte</label>
            <input type="number" placeholder="0.00" formControlName="vt">
          </div>

          <div class="form-group">
            <label>Vale Combustível</label>
            <input type="number" placeholder="0.00" formControlName="vc">
          </div>

          <div class="form-group">
            <label>VEM</label>
            <input type="number" placeholder="0.00" formControlName="vem">
          </div>
        </div>

        <div class="employee-form__footer">
          @if (showError) {
          <div class="employee--message employee--message--error">
            <mat-icon>error</mat-icon>
            <span>{{ errorMessage }}</span>
          </div>
          }
          <button class="cancel-btn" (click)="addEmployee = false">Cancelar</button>
          <button type="submit" class="submit-btn">Salvar</button>
        </div>
      </div>
    </form>

    <div class="loading loading--employees" *ngIf="isLoading">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    </div>
  </div>
</div>
